<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Restmailer by redmoses</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Restmailer</h1>
        <p>Send emails using REST</p>

        <p class="view"><a href="https://github.com/redmoses/restmailer">View the Project on GitHub <small>redmoses/restmailer</small></a></p>


        <ul>
          <li><a href="https://github.com/redmoses/restmailer/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/redmoses/restmailer/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/redmoses/restmailer">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="rest-mailer" class="anchor" href="#rest-mailer" aria-hidden="true"><span class="octicon octicon-link"></span></a>REST Mailer</h1>

<h1>
<a id="background" class="anchor" href="#background" aria-hidden="true"><span class="octicon octicon-link"></span></a>Background</h1>

<p>My company has an application that performs various jobs upon receiving specifically formatted emails. Testing the application with a usual web client like Gmail or desktop clients like Thunderbird is a hassle and time consuming. So to ease the testing process I've written this app. It lets you send emails using JSON REST requests.</p>

<h2>
<a id="technologies" class="anchor" href="#technologies" aria-hidden="true"><span class="octicon octicon-link"></span></a>Technologies</h2>

<ul>
<li>Node.js</li>
<li>Express.js (body-parser, debug)</li>
<li>Nodemailer</li>
<li>Async</li>
</ul>

<h1>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h1>

<p>For sending emails you will have to post the required data to the applications designated URL</p>

<h2>
<a id="request" class="anchor" href="#request" aria-hidden="true"><span class="octicon octicon-link"></span></a>Request</h2>

<div class="highlight highlight-source-yaml"><pre><span class="pl-s"><span class="pl-ent">Request Type:</span> <span class="pl-s">POST</span></span>
<span class="pl-s"><span class="pl-ent">URL:</span> <span class="pl-s">/sendmail/</span></span></pre></div>

<h2>
<a id="parameters" class="anchor" href="#parameters" aria-hidden="true"><span class="octicon octicon-link"></span></a>Parameters</h2>

<table>
<thead>
<tr>
<th>Name</th>
<th align="center">Type</th>
<th align="right">Required</th>
<th align="right">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>to</td>
<td align="center">string</td>
<td align="right">True</td>
<td align="right">Address of the recipient</td>
</tr>
<tr>
<td>subject</td>
<td align="center">string</td>
<td align="right">False</td>
<td align="right">Subject of the email</td>
</tr>
<tr>
<td>message</td>
<td align="center">string</td>
<td align="right">False</td>
<td align="right">Email message</td>
</tr>
<tr>
<td>from*</td>
<td align="center">string</td>
<td align="right">False</td>
<td align="right">From address</td>
</tr>
</tbody>
</table>

<p><em>The from address can be set in both the request parameter and also in the application config. Request parameter takes precedence over config</em></p>

<h2>
<a id="sample-request-data" class="anchor" href="#sample-request-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sample request data</h2>

<p>An email object</p>

<div class="highlight highlight-source-json"><pre>{
  <span class="pl-s"><span class="pl-pds">"</span>to<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>address@email.com<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>subject<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Test Subject<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>message<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>This is a test email<span class="pl-pds">"</span></span>
}</pre></div>

<p>For a successful request you would have to send an array of this object</p>

<div class="highlight highlight-source-json"><pre>[
  {
    <span class="pl-s"><span class="pl-pds">"</span>to<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>address@email.com<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>subject<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Test Subject<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>message<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>This is a test email<span class="pl-pds">"</span></span>
  }
]</pre></div>

<h2>
<a id="for-sending-the-same-email-to-multiple-addresses" class="anchor" href="#for-sending-the-same-email-to-multiple-addresses" aria-hidden="true"><span class="octicon octicon-link"></span></a>For sending the same email to multiple addresses</h2>

<div class="highlight highlight-source-json"><pre>[
  {
    <span class="pl-s"><span class="pl-pds">"</span>to<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>address@email.com, address2@email.com<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>subject<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Test Subject<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>message<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>This is a test email<span class="pl-pds">"</span></span>
  }
]</pre></div>

<h2>
<a id="for-sending-multiple-emails" class="anchor" href="#for-sending-multiple-emails" aria-hidden="true"><span class="octicon octicon-link"></span></a>For sending multiple emails</h2>

<div class="highlight highlight-source-json"><pre>[
  {
    <span class="pl-s"><span class="pl-pds">"</span>to<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>address@email.com<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>subject<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Test Subject<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>message<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>This is a test email<span class="pl-pds">"</span></span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>to<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>address2@email.com<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>subject<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Test Subject 2<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>message<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>This is a test email number 2<span class="pl-pds">"</span></span>
  }
]</pre></div>

<h2>
<a id="curl-request" class="anchor" href="#curl-request" aria-hidden="true"><span class="octicon octicon-link"></span></a>CURL request</h2>

<p>I am assuming you are running the app on port 3000 on localhost</p>

<div class="highlight highlight-source-shell"><pre>curl -H <span class="pl-s"><span class="pl-pds">"</span>Content-Type: application/json<span class="pl-pds">"</span></span> -X POST -d <span class="pl-s"><span class="pl-pds">'</span>[{"to":"address@email.com","subject":"Test Subject","message":"This is a test email"}]<span class="pl-pds">'</span></span> http://localhost:3000/sendmail</pre></div>

<h2>
<a id="response" class="anchor" href="#response" aria-hidden="true"><span class="octicon octicon-link"></span></a>Response</h2>

<p>The response includes all the email objects that were posted with the request. An example response -</p>

<div class="highlight highlight-source-json"><pre>{
  <span class="pl-s"><span class="pl-pds">"</span>status<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>1 out of 2 request(s) successfully processed. 1 request(s) failed.<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>emails<span class="pl-pds">"</span></span>: [
    {
      <span class="pl-s"><span class="pl-pds">"</span>from<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>restmailer@email.com<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>to<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>address@email.com<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>subject<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Test<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>time<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Mon Sep 14 2015 12:55:10 GMT+0000 (UTC)<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>status<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>success<span class="pl-pds">"</span></span>
    },
    {
      <span class="pl-s"><span class="pl-pds">"</span>from<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>restmailer@email.com<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>subject<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Test<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>time<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Mon Sep 14 2015 12:55:10 GMT+0000 (UTC)<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>status<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>failure<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>error<span class="pl-pds">"</span></span>: {
        <span class="pl-s"><span class="pl-pds">"</span>code<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>EENVELOPE<span class="pl-pds">"</span></span>
      }
    }
  ]
}</pre></div>

<p>As you can see the response object contains all the email requests (including the failed ones) for better tracking.</p>

<h1>
<a id="deployment-using-docker" class="anchor" href="#deployment-using-docker" aria-hidden="true"><span class="octicon octicon-link"></span></a>Deployment (using Docker)</h1>

<p>The deployment steps are given below</p>

<ul>
<li>Clone the repository using the following command</li>
</ul>

<div class="highlight highlight-source-shell"><pre>git clone https://github.com/redmoses/restmailer.git</pre></div>

<ul>
<li>Build the docker image</li>
</ul>

<div class="highlight highlight-source-shell"><pre><span class="pl-c"># i'm assuming you've cloned the app in 'restmailer' directory</span>
<span class="pl-c1">cd</span> restmailer
make build</pre></div>

<ul>
<li>Configure the application with mail information. The application requires 4 values to be pre-configured before it can send emails. They are</li>
</ul>

<div class="highlight highlight-source-yaml"><pre><span class="pl-s"><span class="pl-ent">MAIL_HOST:</span> <span class="pl-s">the SMTP server host</span></span>
<span class="pl-s"><span class="pl-ent">MAIL_PORT:</span> <span class="pl-s">SMTP server port, default value is 25</span></span>
<span class="pl-s"><span class="pl-ent">MAIL_FROM:</span> <span class="pl-s">the SMTP address for the app</span></span>
<span class="pl-s"><span class="pl-ent">MAIL_USER:</span> <span class="pl-s">the SMTP server username</span></span>
<span class="pl-s"><span class="pl-ent">MAIL_PASS:</span> <span class="pl-s">the SMTP server password</span></span></pre></div>

<p>You can copy the example config file 'example.conf' to a new file called 'prod.conf'. After that put in your relevant information on this file, replacing the dummy values.</p>

<div class="highlight highlight-source-shell"><pre><span class="pl-c"># i'm assuming you are inside the app directory</span>
cp example.conf prod.conf
vim prod.conf</pre></div>

<ul>
<li>Run the application with the following command</li>
</ul>

<div class="highlight highlight-source-shell"><pre>make start</pre></div>

<h1>
<a id="management-docker" class="anchor" href="#management-docker" aria-hidden="true"><span class="octicon octicon-link"></span></a>Management (Docker)</h1>

<p>You can manage the docker container by using the following Makefile commands</p>

<div class="highlight highlight-source-shell"><pre><span class="pl-c"># start app</span>
make start
<span class="pl-c"># stop app</span>
make stop
<span class="pl-c"># restart app</span>
make restart
<span class="pl-c"># see logs</span>
make logs
<span class="pl-c"># shell access</span>
make shell</pre></div>

<p>Feel free to play around with the Makefile and add your own commands if necessary</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/redmoses">redmoses</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-46861903-4");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
